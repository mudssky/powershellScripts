# 通用换源脚本使用说明（Switch-Mirrors.ps1）

## 概述
- 统一为多个软件提供换源能力的入口脚本，首期支持 `docker`。
- 写入前会对镜像源执行探活测试（`/v2/`），选择最快可用项写入；支持 Dry-Run 与禁用镜像源。

## 快速开始
- 预览计划（不改动文件）：
  - `./Switch-Mirrors.ps1 -Target docker -UseChinaMirror -DryRun`
- 指定候选镜像：
  - `./Switch-Mirrors.ps1 -Target docker -MirrorUrls "https://registry-1.docker.io","https://docker.xuanyuan.me"`
- 移除镜像源配置：
  - `./Switch-Mirrors.ps1 -Target docker -Disable`

## 参数说明
- `-Target`：当前仅支持 `docker`
- `-MirrorUrls <string[]>`：候选镜像列表
- `-UseChinaMirror`：未提供 `MirrorUrls` 时使用内置中国镜像默认值
- `-Disable`：移除镜像源配置
- `-TimeoutSec`：探活超时（默认 5 秒）
- `-Retry`：探活重试次数（默认 1 次）
- `-DryRun`：仅输出将进行的修改，不写文件、不重启

## 行为说明
- 探活判定：
  - 对 `url/v2/` 执行 `HEAD`，如失败再尝试 `GET`
  - 接受 `200/401` 为有效（401 代表需要认证，但仓库在线）
- 写入策略：
  - 在所有有效镜像中按响应耗时排序，完整写入有序列表到 `registry-mirrors`
  - 写入前自动备份 `daemon.json` 为 `daemon.json.bak.<timestamp>`
- 重启：
  - Linux 自动执行 `systemctl daemon-reload && systemctl restart docker`
  - Windows/macOS 输出 Docker Desktop 重启提示

## 注意事项
- 若所有候选镜像不可用，则保持原配置不写入
- 建议在 `-DryRun` 模式下先预览测试结果
- 如需系统/其他包管理器换源，后续版本将逐步支持

