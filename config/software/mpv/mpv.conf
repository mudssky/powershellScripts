#============================== 基础设置 ==============================
# 播放结束后不退出
keep-open=yes
# 记忆播放位置
save-position-on-quit

# 启动时窗口大小
autofit-larger=100%x95%
# 隐藏鼠标
cursor-autohide-fs-only
cursor-autohide=1000
# 关闭osd-bar和no-border搭配uosc插件使用
# osd-bar=no
osc=no
# 关闭窗口边框
no-border

# 始终在最前
ontop=no



#============================== 缓存设置 ==============================
cache=yes
# 现代mpv版本不需要设置过大的缓存，默认即可
demuxer-max-bytes=512MiB
demuxer-max-back-bytes=150MiB

#============================== 视频渲染与解码 (核心优化) ==============================
# --- 渲染器 ---
# 强烈建议使用 gpu-next，它是未来的标准，对 HDR 和 AMD 显卡更友好
vo=gpu-next
# 使用高质量预设
# profile=gpu-hq

# --- 硬件解码 ---
# 警告：之前是 hwdec=no (软解)，这对 CPU 压力极大。
# 建议开启硬解。auto-safe 会优先选择最稳定的硬解方式 (Windows下通常是 d3d11va)
hwdec=auto-safe
# 如果你需要使用一些高级滤镜或着色器，可能需要用 copy 模式 (稍耗内存，但兼容性好)
# hwdec=auto-copy

# ewa_lanczossharp: 画面更锐利，比 spline36 更好 (消耗略高，但 4060/680M 毫无压力)
scale=ewa_lanczossharp
cscale=ewa_lanczossharp
dscale=mitchell


# 开启色带去除 (Deband)，对所有视频都有益
deband=yes
deband-iterations=2
deband-threshold=35
deband-range=20
deband-grain=5

# --- Windows 显卡 API ---
gpu-api=d3d11
# 允许 10bit 输出 (如果显示器支持)
d3d11-output-format=auto

# --- 画面同步与插帧 (平滑度) ---
# 开启显示器同步，消除画面撕裂和微卡顿
video-sync=display-resample
# 允许为了同步音频而调整的最大速度幅度
video-sync-max-video-change=5

# --- 补帧/插帧算法 ---
# 必须开启 interpolation 才能让 tscale 生效
interpolation=yes
# oversample: 几乎无模糊，还原 24帧 电影感，单纯消除抖动 (推荐)
# mitchell:   带有轻微模糊，更平滑 (如果不喜欢 oversample 可换这个)
tscale=oversample

#============================== 色彩管理 ==============================
# 色彩抖动 (解决 8bit 显示器色彩断层)
dither-depth=auto
# 自动加载 ICC 配置文件 (如果 gpu-next 可能会自动处理，但显式写上也无妨)
icc-profile-auto
# 3dlut 大小，5600G 核显建议保持默认或较低，太高会显著增加启动白屏时间
# icc-3dlut-size=64x64x64

# Shader 缓存路径 (加速启动)
gpu-shader-cache-dir="~~/shaders_cache"

#============================== 音频设置 ==============================
volume=100
volume-max=200
# Windows 推荐使用 wasapi
ao=wasapi
# 独占模式 (开启后其他软件没声音，需要时取消注释)
# audio-exclusive=yes
# 音频轨道偏好
alang=jpn,ja,eng,en

#============================== 字幕设置 ==============================
sub-auto=fuzzy
sub-file-paths=subs
slang=chi,zh-CN,sc,chs

#============================== 截图设置 ==============================
screenshot-format=webp
screenshot-webp-lossless=no
screenshot-webp-quality=85
screenshot-high-bit-depth=yes
screenshot-tag-colorspace=yes
# 文件名模板
screenshot-template="%F-%p-%02n"
# 截图目录
screenshot-directory=screenshots

#============================== 本地配置引用 ==============================
# 放在profile定义前
# 用于加载不存入仓库的本地特定设置 (如特定显示器的校色路径、具体显卡指定等)
include="mpv_local.conf"

#============================== profile定义 ==============================

# --- 1. 动漫增强模式 (Anime4K) ---
# 使用方法：在 input.conf 绑定按键应用该 profile
# 效果：线条锐化、降噪、纹理重构 (会有明显的"油画感"消除和清晰度提升)
[anime]
profile-desc=动漫增强 (Anime4K)
# 如果之前开启了 FSRCNNX 或其他，先清空
glsl-shaders-clr
# 按顺序加载：防止过曝 -> 降噪/修复 -> 2倍放大 -> 自动降采样(如需)
# 注意：Anime4K v4.0.1 文件名中 AutoDownscalePre 没有下划线
glsl-shaders="~~/shaders/Anime4K/Anime4K_Clamp_Highlights.glsl;~~/shaders/Anime4K/Anime4K_Restore_CNN_VL.glsl;~~/shaders/Anime4K/Anime4K_Upscale_CNN_x2_VL.glsl;~~/shaders/Anime4K/Anime4K_AutoDownscalePre_x4.glsl;~~/shaders/Anime4K/Anime4K_AutoDownscalePre_x2.glsl"

# --- 2. 真人/电影增强模式 (FSRCNNX + Sharpen) ---
# 效果：极其忠实的画面放大，保留皮肤纹理，去除模糊，不产生油画感
[real]
profile-desc=真人增强 (FSRCNNX)
glsl-shaders-clr
# 1. KrigBilateral: 修复色度 (让颜色边缘更准)
# 2. FSRCNNX: 神经网络放大 (比默认的 ewa_lanczossharp 更清晰)
# 3. Adaptive Sharpen: 适度锐化
glsl-shaders="~~/shaders/Common/KrigBilateral.glsl;~~/shaders/FSRCNNX/FSRCNNX_x2_8-0-4-1.glsl;~~/shaders/Common/adaptive-sharpen.glsl"

# --- 3. 还原模式 (关闭所有特效) ---
# 用于 4K 原盘等不需要处理的高画质源，或者显卡负载太高时
[native]
profile-desc=原画模式
glsl-shaders-clr
scale=ewa_lanczossharp
cscale=ewa_lanczossharp

[moyu]
profile-desc=摸鱼模式

# --- 1. 几何与外观 (覆盖全局) ---
# ontop=yes               # 置顶
border=no               # 无边框
osd-bar=no              # 不显示进度条
window-scale=0.2        # 缩小
geometry=98%:95%        # 右下角定位

# --- 2. 性能与静音 (关键！显式重置全局的高级设置) ---
# 小窗口看不出画质区别，强制改回最普通的双线性插值，让显卡休息
scale=bilinear
cscale=bilinear
dscale=bilinear
tscale=bilinear

# 关闭插帧 (全局开了 interpolation=yes，这里要关掉)
interpolation=no

# 清空所有挂载的着色器 (如果全局用了 Anime4K 等，这里必须清空)
glsl-shaders=""

# 甚至可以强制降低渲染质量以确保风扇不转 (可选)
# profile=fast
