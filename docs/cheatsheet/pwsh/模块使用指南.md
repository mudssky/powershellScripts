这是一份 PowerShell (pwsh) 模块使用速查表 (Cheatsheet)，涵盖了从**安装管理**、**日常使用**到**开发创建**的核心命令。

---

### 📦 1. 模块安装与管理 (PowerShell Gallery)

*这部分命令用于从互联网（如 PSGallery）下载和管理模块。*

| 任务 | 命令示例 | 说明 |
| :--- | :--- | :--- |
| **搜索模块** | `Find-Module -Name "PSWriteHTML"` | 在库中查找模块 |
| **安装模块** | `Install-Module -Name "Name"` | 需要管理员权限 (默认 Scope 为 AllUsers) |
| **当前用户安装** | `Install-Module "Name" -Scope CurrentUser` | **推荐**，无需管理员权限 |
| **更新模块** | `Update-Module -Name "Name"` | 更新到最新版本 |
| **卸载模块** | `Uninstall-Module -Name "Name"` | 从硬盘删除模块文件 |
| **保存但不安装** | `Save-Module "Name" -Path "C:\Temp"` | 仅下载文件，用于离线传输 |
| **信任仓库** | `Set-PSRepository -Name "PSGallery" -InstallationPolicy Trusted` | 避免每次安装都提示警告 |

---

### 🚀 2. 加载与会话管理

*这部分命令用于管理当前 PowerShell 窗口中运行的模块。*

| 任务 | 命令示例 | 说明 |
| :--- | :--- | :--- |
| **导入模块** | `Import-Module "Name"` | 手动加载 (通常系统会自动加载) |
| **强制重载** | `Import-Module "Name" -Force` | 重新加载模块 (用于调试更新后的代码) |
| **全局导入** | `Import-Module "Name" -Scope Global` | 让模块在脚本外也生效 |
| **移除模块** | `Remove-Module "Name"` | 从**内存**中卸载 (不会删除文件) |
| **导入指定文件** | `Import-Module ".\MyScript.psm1"` | 通过路径直接导入 .psm1 文件 |

---

### 🔍 3. 探索与发现

*查看已安装了什么，或者模块里有什么功能。*

| 任务 | 命令示例 | 说明 |
| :--- | :--- | :--- |
| **列出已加载** | `Get-Module` | 查看当前会话中正在运行的模块 |
| **列出所有可用** | `Get-Module -ListAvailable` | 查看本机所有已安装的模块 (包含未加载的) |
| **查找特定模块** | `Get-Module -ListAvailable -Name "*VM*"` | 支持通配符搜索 |
| **查看模块命令** | `Get-Command -Module "Name"` | **最常用**，列出该模块提供的所有函数/命令 |
| **查看模块属性** | `(Get-Module "Name").Path` | 查看模块文件具体在硬盘的哪里 |

---

### 🛠️ 4. 模块开发 (编写自己的模块)

*如何创建一个简单的模块。*

#### 文件扩展名

* **`.psm1` (Script Module)**: 核心代码文件，包含函数定义。
* **`.psd1` (Module Manifest)**: 描述文件（元数据），包含版本号、作者、依赖项等。

#### 常用代码片段

```powershell
# 1. 在 .psm1 文件中导出函数 (控制哪些函数给用户用)
function Get-MyTool { ... }
function Helper-Internal { ... } # 内部函数，不导出

Export-ModuleMember -Function Get-MyTool # 只有这个能被用户看见

# 2. 自动生成 .psd1 清单文件
New-ModuleManifest -Path ".\MyModule.psd1" -RootModule "MyModule.psm1" -Author "Me" -Description "My Tools"
```

#### 标准目录结构

为了让 `Import-Module MyTool` 直接工作，文件结构必须如下：

```text
.../Modules/
    └── MyTool/              <-- 文件夹名必须与模块名一致
        ├── MyTool.psd1      <-- 清单文件名必须与文件夹名一致
        └── MyTool.psm1      <-- 脚本文件
```

---

### 📂 5. 路径与环境变量

*PowerShell 去哪里找模块？*

| 变量/命令 | 说明 |
| :--- | :--- |
| **`$env:PSModulePath`** | 存储所有模块搜索路径的环境变量 |
| **查看路径列表** | `$env:PSModulePath -split ';'` (Windows) <br> `$env:PSModulePath -split ':'` (Linux/Mac) |
| **用户路径 (Win)** | `~\Documents\PowerShell\Modules` (PowerShell 7) <br> `~\Documents\WindowsPowerShell\Modules` (WinPS 5.1) |
| **系统路径 (Win)** | `C:\Program Files\PowerShell\Modules` |

---

### 💡 6. 常见问题 (Troubleshooting)

* **命令找不到？**
  * 检查模块是否在 `$env:PSModulePath` 中。
  * 检查是否被杀毒软件拦截。
  * 运行 `Get-Module -ListAvailable` 确认模块是否存在。

* **版本冲突？**
  * PowerShell 可以并存多个版本的模块。
  * 指定版本导入：`Import-Module "Name" -RequiredVersion 1.2.3`

* **无法运行脚本？**
  * 检查执行策略：`Get-ExecutionPolicy`
  * 临时允许：`Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser`

### 📝 7. 简易速记口诀

* **找**模块用 `Find`
* **装**模块用 `Install`
* **看**有什么用 `Get-Command`
* **删**文件用 `Uninstall`
* **清**内存用 `Remove`
