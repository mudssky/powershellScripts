# Dify 生态最佳实践

Dify 适合把“LLM 能力”产品化：用可视化工作流交付应用，用统一平台做模型/知识库/工具治理。要把它当“应用平台”，而不是一个简单的 Prompt 界面。

**1. 适用边界（什么时候用 Dify）**

* **适合**：多应用并行、业务方需要自助配置、需要统一的权限/审计/成本治理、交付节奏快。
* **不适合**：强自定义的底层推理优化（极致延迟/成本）、复杂私有协议/数据面深度改造（这类更偏自研服务）。

**2. 工作流设计（把不确定性拆开）**

* **分层**：预处理（清洗/路由）-> 检索（RAG）-> 生成（LLM）-> 校验（结构化/安全）-> 后处理（格式化/引用）。
* **可控优先**：关键链路尽量用确定性节点（条件分支、工具节点、校验节点）收敛自由生成空间。
* **失败策略**：对外部工具调用设置超时与重试；对 JSON/Schema 校验失败要有自修正或降级路径。

**3. 知识库治理（KB 不是“导入就完事”）**

* **ETL 优先**：文档清洗、去噪、结构化比“调 Prompt”更影响最终效果。
* **版本化**：索引/切分策略/embedding 模型变化会影响线上效果，建议像发布一样做版本与回滚。
* **权限与审计**：多租户/多部门场景要做按权限检索（ACL-aware），并能审计“回答引用了哪些来源”。

**4. 版本管理与环境隔离（把平台配置纳入工程体系）**

* **导出并入库**：将应用与工作流配置导出，纳入 Git；每次改动可 diff、可回滚。
* **环境分离**：dev/staging/prod 分开；密钥与连接信息用环境变量/密钥管理，不要写死在配置里。
* **灰度发布**：关键应用的变更建议先在 staging 跑回归集，再小流量灰度。

**5. 运营与成本（平台治理的核心）**

* 监控 token 成本、调用失败率、超时率、缓存命中、用户反馈（点赞/点踩）并形成闭环。
* 对高成本场景做分层路由（小模型处理简单任务，大模型处理复杂任务）。

## 相关工具链接

- Dify：<https://github.com/langgenius/dify>
