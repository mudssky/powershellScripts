## 曾经使用过的的一种配置

网站目录在`/root/sites`

目录结构是

```shell
tree -L 1
.
├── Caddyfile
├── xh-components
└── xh-knowledge

```

caddyfile配置如下

```
:30080 {
root * xh-knowledge
file_server
}
:30081 {
root * xh-components
file_server
}
```

启动的时候是最简单的，只要在目录下执行

```
caddy start
```

这样就会自动加载配置并在后台执行了

`caddy run` 则是在前台执行



如果用systemd启动，可以执行

查看caddy状态

```
systemctl status caddy
```



关闭caddy服务

```
sudo systemctl stop caddy
```

永久禁用

```shell
sudo systemctl disable caddy
```



| 命令                         | 功能描述                                                     |
| ---------------------------- | ------------------------------------------------------------ |
| sudo systemctl start caddy   | 启动 Caddy 服务。                                            |
| sudo systemctl restart caddy | 重新启动 Caddy 服务 (先停止再启动，会有短暂的服务中断)       |
| sudo systemctl reload caddy  | **推荐！** 重新加载配置文件而**不中断服务**。当您修改了 Caddyfile 后，应该使用此命令。 |
| sudo systemctl enable caddy  | 使 Caddy 服务在服务器启动时自动运行。                        |



## 最佳实践

caddy 安装后，默认配置文件路径是`/etc/caddy/Caddyfile`

创建两个目录：sites-available 和 sites-enabled，类似于Nginx的配置方式。

1. **/etc/caddy/sites-available/**: 为您的每一个网站创建一个单独的配置文件。
2. **/etc/caddy/sites-enabled/**: 在这个目录中创建指向sites-available中相应文件的符号链接，来“激活”您想要上线的网站



**1. 调整主Caddyfile**

首先，编辑主配置文件/etc/caddy/Caddyfile，使其导入sites-enabled目录下的所有配置。

**路径**: `/etc/caddy/Caddyfile`

```
# 导入所有启用的网站配置
import sites-enabled/*
```这个简单的指令告诉Caddy加载`sites-enabled`目录中的每一个文件作为其配置的一部分。
```

2.**为您的网站创建单独的配置文件**

接下来，为您的每个网站在`sites-available`目录下创建独立的配置文件。这里我们使用域名而非端口号，因为这更接近真实场景，并且Caddy可以为此自动管理HTTPS证书。 

**网站1配置文件**: `/etc/caddy/sites-available/xh-knowledge.conf`

````caddy
```
# 知识库网站
xh-knowledge.your-domain.com {
    # 设置网站根目录
    root * /path/to/your/sites/xh-knowledge
    
    # 启用文件服务器以提供静态文件
    file_server
    
    # 您还可以添加其他指令，例如日志
    log {
        output file /var/log/caddy/xh-knowledge.log
    }
}
````

**网站2配置文件**: `/etc/caddy/sites-available/xh-components.conf`

```caddy
# 组件库网站
xh-components.your-domain.com {
    # 设置网站根目录
    root * /path/to/your/sites/xh-components

    # 启用文件服务器
    file_server

    # 单独的日志文件
    log {
        output file /var/log/caddy/xh-components.log
    }
}
```

**注意**:

- 请将 your-domain.com 替换为您的真实域名，并将/path/to/your/sites/替换为网站文件的实际存储路径。
- 只要您的域名正确解析到服务器的IP地址，Caddy会自动通过Let's Encrypt获取并续订HTTPS证书。

**3. 启用网站**

```
# 启用知识库网站
sudo ln -s /etc/caddy/sites-available/xh-knowledge.conf /etc/caddy/sites-enabled/xh-knowledge.conf

# 启用组件库网站
sudo ln -s /etc/caddy/sites-available/xh-components.conf /etc/caddy/sites-enabled/xh-components.conf
```

**4. 重新加载Caddy配置**

```
sudo systemctl reload caddy
```









