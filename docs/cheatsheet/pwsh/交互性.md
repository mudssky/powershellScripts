这是一份 **PowerShell 脚本交互性速查表 (Cheatsheet)**。你可以直接复制这些代码片段到你的脚本中，快速提升用户体验。

---

### 1. 基础输入 (Basic Input)

最常用的获取用户输入的方式。

| 功能 | 代码片段 |
| :--- | :--- |
| **普通输入** | `$Input = Read-Host "请输入用户名"` |
| **密码输入** (掩码) | `$Pass = Read-Host "请输入密码" -AsSecureString` |
| **按任意键继续** | `Write-Host "按任意键继续..."; $null = $Host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")` |
| **带颜色的输出** | `Write-Host "成功!" -ForegroundColor Green -BackgroundColor Black` |
| **倒计时等待** | `Start-Sleep -Seconds 5` |

---

### 2. 菜单与选择 (Selection & Menus)

让用户做选择，而不是输入文本。

#### 方案 A: 图形化列表 (推荐，最快实现)

弹出一个搜索框窗口，支持多选 (`Ctrl`+点击)。

```powershell
$Services = Get-Service | Select-Object Name, Status, DisplayName
# -PassThru 将选择结果传回变量
$Selected = $Services | Out-GridView -Title "请选择服务(支持多选)" -PassThru

if ($Selected) { Write-Host "你选择了: $($Selected.Name)" }
```

#### 方案 B: 原生控制台菜单 (Y/N/A)

适合简单的二选一或三选一。

```powershell
$Title = "确认操作"
$Msg   = "是否要删除该文件?"
$Opts  = @(
    [System.Management.Automation.Host.ChoiceDescription]::new("&Yes", "确认删除"),
    [System.Management.Automation.Host.ChoiceDescription]::new("&No",  "取消操作"),
    [System.Management.Automation.Host.ChoiceDescription]::new("&All", "全部删除")
)
# 最后一个参数 1 代表默认选 No
$Result = $Host.UI.PromptForChoice($Title, $Msg, $Opts, 1)

switch ($Result) { 0 {"删除"} 1 {"取消"} 2 {"全删"} }
```

#### 方案 C: 文本循环菜单 (TUI)

适合常驻型工具脚本。

```powershell
do {
    Clear-Host
    Write-Host "=== 工具箱 ===" -Fg Cyan
    Write-Host "[1] 选项 A"
    Write-Host "[Q] 退出"
    $Ans = Read-Host "请选择"
    switch ($Ans) {
        '1' { Write-Host "执行A..."; Pause }
        'Q' { break }
    }
} until ($Ans -eq 'Q')
```

---

### 3. 高级参数技巧 (Parameter Binding)

利用 PowerShell 原生机制，实现自动补全和强制提示。

#### 限制输入范围 (下拉列表效果)

用户按 `Tab` 键只能在指定值中切换。

```powershell
param(
    [Parameter(Mandatory=$true, HelpMessage="请输入环境名称")]
    [ValidateSet("Dev", "Test", "Prod")] 
    [string]$Environment
)
```

#### 危险操作确认 (WhatIf / Confirm)

让脚本支持 `-WhatIf` (模拟执行) 和 `-Confirm` (弹窗确认)。

```powershell
[CmdletBinding(SupportsShouldProcess=$true, ConfirmImpact="High")]
param()

# 只有用户确认后才会执行
if ($PSCmdlet.ShouldProcess("目标服务器", "重启操作")) {
    Write-Host "正在重启..."
}
# 调用: ./Script.ps1 (自动弹窗)
# 调用: ./Script.ps1 -Force (跳过确认)
```

---

### 4. 进度与反馈 (Feedback)

#### 进度条 (Progress Bar)

适合循环处理大量数据。

```powershell
$Total = 50
for($i=1; $i -le $Total; $i++) {
    Write-Progress -Activity "正在迁移数据" -Status "处理第 $i 个文件" -PercentComplete (($i / $Total) * 100)
    Start-Sleep -Milliseconds 50
}
Write-Progress -Activity "正在迁移数据" -Completed
```

#### 自动生成 GUI 表单

偷懒神器，直接把脚本参数变成窗口。

```powershell
function Start-MyTask {
    param([string]$Name, [int]$Count)
    Write-Host "Hello $Name, count is $Count"
}
# 这一行会自动生成填表窗口
Show-Command Start-MyTask
```

---

### 5. Windows 弹窗 (GUI Popups)

调用 .NET 类库实现真正的 Windows 弹窗。

#### 消息弹窗 (MessageBox)

```powershell
Add-Type -AssemblyName System.Windows.Forms
$Result = [System.Windows.Forms.MessageBox]::Show("磁盘已满，是否清理?", "警告", "YesNo", "Warning")

if ($Result -eq 'Yes') { Write-Host "清理中..." }
```

#### 文件选择器 (File Open Dialog)

```powershell
Add-Type -AssemblyName System.Windows.Forms
$FileBrowser = New-Object System.Windows.Forms.OpenFileDialog
$FileBrowser.Filter = "文本文件 (*.txt)|*.txt|所有文件 (*.*)|*.*"
$FileBrowser.Title  = "请选择配置文件"

if ($FileBrowser.ShowDialog() -eq 'OK') {
    Write-Host "你选择了: $($FileBrowser.FileName)"
}
```

#### 简易输入框 (VisualBasic InputBox)

比 Read-Host 更友好的图形化输入。

```powershell
Add-Type -AssemblyName Microsoft.VisualBasic
$User = [Microsoft.VisualBasic.Interaction]::InputBox("请输入用户名", "登录", "Admin")
```

---

### 6. 现代终端美化 (ANSI / PSStyle)

PowerShell 7+ 或 Windows 10/11 适用，让文本更生动。

#### 使用 ANSI 转义码

```powershell
$ESC = [char]27
Write-Host "$ESC[1;31m加粗红色警告$ESC[0m"
Write-Host "$ESC[4;34m带下划线的蓝色链接$ESC[0m"
```

#### 使用 $PSStyle (PWSH 7.2+)

```powershell
Write-Host "$($PSStyle.Formatting.Bold)粗体文本$($PSStyle.Reset)"
Write-Host "$($PSStyle.Foreground.BrightGreen)成功信息$($PSStyle.Reset)"
# 定义超链接 (终端支持点击)
Write-Host "$($PSStyle.Link)https://google.com$($PSStyle.LinkEnd)"
```

---

### 速查总结：该用哪个？

1. **自己用，想要快** → `Out-GridView -PassThru`
2. **给同事用，怕输错** → `[ValidateSet()]` 参数
3. **危险操作** → `SupportsShouldProcess` (WhatIf/Confirm)
4. **需要用户填表** → `Show-Command`
5. **需要选择文件** → `OpenFileDialog`
