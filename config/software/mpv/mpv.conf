#============================== 基础设置 ==============================
# 播放结束后不退出
keep-open=yes
# 记忆播放位置
save-position-on-quit

# 启动时窗口大小
autofit-larger=100%x95%
# 隐藏鼠标
cursor-autohide-fs-only
cursor-autohide=1000
# 关闭osd-bar和no-border搭配uosc插件使用
# osd-bar=no
osc=no
# 关闭窗口边框
no-border

# 始终在最前
ontop=no



#============================== 缓存设置 ==============================
cache=yes
# 现代mpv版本不需要设置过大的缓存，默认即可
demuxer-max-bytes=512MiB
demuxer-max-back-bytes=150MiB

#============================== 视频渲染与解码 (核心优化) ==============================
# --- 渲染器 ---
# 强烈建议使用 gpu-next，它是未来的标准，对 HDR 和 AMD 显卡更友好
vo=gpu-next
# 使用高质量预设
profile=high-quality

# --- 硬件解码 ---
# 警告：之前是 hwdec=no (软解)，这对 CPU 压力极大。
# 建议开启硬解。auto-safe 会优先选择最稳定的硬解方式 (Windows下通常是 d3d11va)
hwdec=auto-safe
# 如果你需要使用一些高级滤镜或着色器，可能需要用 copy 模式 (稍耗内存，但兼容性好)
# hwdec=auto-copy

# 缩放算法 (high-quality 默认已经是 ewa_lanczos，sharp 版本甚至可能引入振铃效应，建议先注释观察)
# ewa_lanczossharp: 画面更锐利，比 spline36 更好 (消耗略高，但 4060/680M 毫无压力)
# scale=ewa_lanczossharp
# cscale=ewa_lanczossharp
dscale=mitchell

# HDR 直通与色调映射优化 (gpu-next 核心优势)
target-colorspace-hint=yes
tone-mapping=spline


# deband主要对低码率视频起作用，对蓝光原片会破坏细节
deband=no

# --- Windows 显卡 API ---
gpu-api=d3d11
# 允许 10bit 输出 (如果显示器支持)
d3d11-output-format=auto

# --- 画面同步与插帧 (平滑度) ---
# 开启显示器同步，消除画面撕裂和微卡顿
video-sync=display-resample
# 允许为了同步音频而调整的最大速度幅度
video-sync-max-video-change=5

# --- 补帧/插帧算法 ---
# 必须开启 interpolation 才能让 tscale 生效
interpolation=yes
# oversample: 几乎无模糊，还原 24帧 电影感，单纯消除抖动 (推荐)
# mitchell:   带有轻微模糊，更平滑 (如果不喜欢 oversample 可换这个)
tscale=oversample
# 解决开启插帧后字幕顿挫问题
# 将字幕渲染到视频源分辨率，并随视频一起进行色彩管理和插帧
# 开启后字幕会保持原视频分辨率，关闭后字幕会放大更锐利但是会抖动
blend-subtitles=yes

#============================== 色彩管理 ==============================
# 色彩抖动 (解决 8bit 显示器色彩断层)
dither-depth=auto
# 自动加载 ICC 配置文件 (如果 gpu-next 可能会自动处理，但显式写上也无妨)
icc-profile-auto
# 3dlut 大小，5600G 核显建议保持默认或较低，太高会显著增加启动白屏时间
# icc-3dlut-size=64x64x64

# Shader 缓存路径 (加速启动)
gpu-shader-cache-dir="~~/shaders_cache"

#============================== 音频设置 ==============================
volume=100
volume-max=200
# Windows 推荐使用 wasapi
ao=wasapi
# 独占模式 (开启后其他软件没声音，需要时取消注释)
# audio-exclusive=yes
# 音频轨道偏好
alang=jpn,ja,eng,en

#============================== 字幕设置 ==============================
sub-auto=fuzzy
sub-file-paths=subs
slang=chi,zh-CN,sc,chs



#============================== 截图设置 ==============================
screenshot-format=webp
screenshot-webp-lossless=no
screenshot-webp-quality=85
screenshot-high-bit-depth=yes
screenshot-tag-colorspace=yes
# 文件名模板
screenshot-template="%F-%p-%02n"
# 截图目录
screenshot-directory=screenshots
# 建议加上这个，否则截图可能与实际看到的画面（带 Shader）颜色/亮度不一致
screenshot-sw=no


#============================== 本地配置引用 ==============================
# 放在profile定义前
# 用于加载不存入仓库的本地特定设置 (如特定显示器的校色路径、具体显卡指定等)
include="mpv_local.conf"

#============================== profile定义 ==============================

# --- 1. 动漫增强模式 (Anime4K) ---
# 使用方法：在 input.conf 绑定按键应用该 profile
# 效果：线条锐化、降噪、纹理重构 (会有明显的"油画感"消除和清晰度提升)
[anime]
profile-desc=动漫增强 (Anime4K)
deband=yes
# 如果之前开启了 FSRCNNX 或其他，先清空
glsl-shaders-clr
# 按顺序加载：防止过曝 -> 降噪/修复 -> 2倍放大 -> 自动降采样(如需)
# 注意：Anime4K v4.0.1 文件名中 AutoDownscalePre 没有下划线
glsl-shaders="~~/shaders/Anime4K/Anime4K_Clamp_Highlights.glsl;~~/shaders/Anime4K/Anime4K_Restore_CNN_VL.glsl;~~/shaders/Anime4K/Anime4K_Upscale_CNN_x2_VL.glsl;~~/shaders/Anime4K/Anime4K_AutoDownscalePre_x4.glsl;~~/shaders/Anime4K/Anime4K_AutoDownscalePre_x2.glsl"

# --- 2. 真人/电影增强模式 (FSRCNNX + Sharpen) ---
# 效果：极其忠实的画面放大，保留皮肤纹理，去除模糊，不产生油画感
[real]
profile-desc=真人增强 (FSRCNNX)
# 真人电影通常不需要 deband，除非是低码率的网剧
deband=no
glsl-shaders-clr
# 1. KrigBilateral: 修复色度 (让颜色边缘更准)
# 2. FSRCNNX: 神经网络放大 (比默认的 ewa_lanczossharp 更清晰)
# 3. Adaptive Sharpen: 适度锐化
# 建议：如果不需要极致的锐度，可以将 adaptive-sharpen 去掉，FSRCNNX 本身已经很清晰
glsl-shaders="~~/shaders/Common/KrigBilateral.glsl;~~/shaders/FSRCNNX/FSRCNNX_x2_8-0-4-1.glsl;"
# glsl-shaders="~~/shaders/Common/KrigBilateral.glsl;~~/shaders/FSRCNNX/FSRCNNX_x2_8-0-4-1.glsl;~~/shaders/Common/adaptive-sharpen.glsl"

# --- 3. 还原模式 (关闭所有特效) ---
# 用于 4K 原盘等不需要处理的高画质源，或者显卡负载太高时
[native]
profile-desc=原画模式
glsl-shaders-clr
deband=no
# scale=ewa_lanczossharp
# cscale=ewa_lanczossharp

[moyu]
profile-desc=摸鱼模式
deband=no
# 强制覆盖为最快预设
profile=sw-fast
# 再次强制关闭插帧
interpolation=no
# 再次强制清空着色器
glsl-shaders-clr
# 几何设置
ontop=no
border=no
osd-bar=no
window-scale=0.3
geometry=98%:95%
# 摸鱼建议默认静音，避免社死
mute=yes